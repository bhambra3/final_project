---
title: 'The state of mothers in a developing India'
subtitle: 'Trends in the DHS Indian Family Health Survey from 1992'
author: "Nikhil Bhambra"
date: 'April 10th, 2022'
output: 
  pdf_document: 
    number_sections: yes
thanks: "Analysis repository available at https://github.com/nkhi/paper4"
toc: true
bibliography: references.bib
---

```{r, message=FALSE, warning=FALSE, include=FALSE}

# install libraries
if(!require('tidyverse')) {install.packages('tidyverse') } else { library(tidyverse) }
if(!require('here')) {install.packages('here') } else { library(here) }
if(!require('knitr')) {install.packages('knitr') } else { library(knitr) }
```

```{r, message=FALSE, warning=FALSE, include=FALSE}
# Code used to make dataset.csv

# all data sheets
perf <- read.csv("./inputs/data/nbastats.csv")
attr <- read.csv("../../inputs/data/attributes.csv")

# attr but just height/weight
attr_small <- select(attr, 'FULL.NAME', HEIGHT, WEIGHT)

# join on name to get heights/weights
all <- merge(perf, attr_small, by="FULL.NAME")

# drop NA, 613 values. Drop dups, 551 values.
all_sm <- na.omit(all)
final_dataset <- all_sm %>% distinct(FULL.NAME, .keep_all=TRUE)

# output
write.csv(final_dataset, "../../inputs/data/dataset.csv")

```

\newpage

# Introduction

India was thrust into a civil war in 1945 after poor civil planning from exiting colonialists ignited decades of religious tension. For many Indians, the aftermath of regaining freedom was gruesome and the road to rebuilding their new lives was long. India was faced with a new set of challenges, namely the issue of building public health infrastructure and supporting it's exploding population with public infrastructure. To make matters worse, India is one of the largest countries by land mass with extreme cultural and ethnic diversity as well as strict social norms, making it difficult to accurately assess the state of the nation without first assessing the state of her constituent provinces. India's solution in the 1940s was to focus on the growth of domestic markets, manufacturing, and exporting labour, and it has succeeded in becoming a powerful democracy with financial and military power. However the path to development was difficult, and it would have been worse without understanding the national state of affairs to help create goals for the future. This was the aim of the Demographic and Health Survey (DHS) program sponsored by the United States Agency for International Development (USAID), an initiative designed to assess the state of affairs in developing nations. In April 1992, the DHS began a 16-month survey initiative known as the National Family Health Survey (NFHS) to "collect reliable and up-to-date information on fertility, family planning, mortality, and maternal and child health." (IIPS/India (1995)). As the first study of it's kind to be conducted in India since regaining independence, it is the earliest data available on family health in the country. As well it provides an interesting look into the lives of women and children at this point in history. The NFHS was a collaborative effort, aimed at bolstering the "research capabilities of the Population Research Centres in India, initiated by he Ministry of Heath and Family Welfare (MOHFW)" to hopefully to conduct future surveys. The NFHS published it's report in August 1995, which collected responses from 89,777 ever-married women between 13 and 49 regarding marriage, fertility, family planning, contraception use, child feeding practices, knowledge of AIDS, among other topics. It is useful to know that the households covered in the survey included 500,492 residents, which was roughly 0.05% of India's 909.3 million person population in 1992.

This report will be an analysis of The National Family Health Survey (NFHS), focusing on the main deliverable of this paper, the "Fact Sheet - State Findings" which can be found on pages 31 and 32. The R Statistical language (R Core Team (2022)) is used to manipulate data in order to simulate potential expectations for what this dataset could look like under normal conditions. Then, using the pdftools (Ooms (2022)) and pointblank (Iannone (2022)) libraries, the fact sheet is transcribed and manipulated into a usable dataset. This data is used to visualize and understand the relationships between variables and the reported findings. Finally, implications and limitations of these findings are discussed with respect to the goals of the NFHS and the role of data analysis in public policy planning. 

# Data

The NFHS is available on the DHS program website as a PDF (IIPS/India (1995)). Included are detailed statistics about resource access, family expectations and goals, child health, women's health, and knowledge of disease. The aim of this report was to understand the state of women and children as the nation grows into maturity to hopefully improve the quality of life for these usually vulnerable populations, as well as identifying systemic flaws in public care to improve aid administration. The report only displays computed statistics at a province level and as such, detailed distribution features can not be analysed, but the differences across Strata can be examined. The synthesis of all findings is available on pages 31 and 32. The full page tables include detailed information on a per-province level which is included as Figure 1.

I focus on the following features: `Percent of Illiterate Females`, `Percent of Females Attending School`, `Percent of Women Married before age 18`, `Total Fertility Rate`, `Percent of Women using any Contraceptive Method`, `Percent of Births delivered in Health Facility`. This set was chosen because it is describes the conditions of Indian mothers, an under appreciated role in India's strictly religious and predominantly patriarchal social hierarchy. Women often have many children early in life, instead of achieving higher education or employment opportunities. In the fact-sheet, these features are given at a geographic-level of each of the 25 states. 

```{r, echo=FALSE, out.width = '90%'}
dhs <- read_csv(here::here("outputs/data/cleaned_data.csv"), show_col_types = FALSE)
cut_data <- dhs |>
  select(c(1, 2, 3, 5, 7, 8))
cut <- cut_data |>
  slice(1:10)
colnames(cut) <-  c("State", "Illiterate Females", "Females going to School", "Females married before 18", "Fertility Rate", "Percent of Women on contraception")
kable(cut, caption="A glimpse of the transcribed dataset subset", booktabs=TRUE)
```

```{r, warning=FALSE, echo=FALSE, fig.align="center", fig.cap="Fact Sheet - State Findings Table", out.width = '90%'}
include_graphics(here::here("report/figures/fact_sheet_pg_31_32.png"))
```

## Data Preparation Methodology

To formulate the focus of the survey and the questions within it, a Design Workshop was help in Pune, India in Sept. 1991. Statisticians from IIPS and USAID designed the contents with a euro-centric perspective (i.e. around AIDS knowledge, contraceptive use, etc). As with all surveys of this scale, the questions were adjusted to ensure they were not culturally offensive. From this conference the Household Questionnaire, Woman’s Questionnaire, and Village Questionnaire were created (IIPS/India (1995)). These surveys were meant to be taken in turn to determine eligibility of applicants for the main NFHS analysis. First, the Household questionnaire collected information on age, sex, marital status, education status, and access to water/toilets. The Woman's questionnaire gathered information on number of children, use of contraception, reasons for wanting children, children health, breastfeeding, and other mother-child related topics. Finally the Village questionnaire was used to assess the states of villages across India's provinces about access to electricity, water, education, etc. Together, these three targeted question sets gave the researchers insight into how women lived across the country.

The NFHS needed to be implemented in a way that is maximally accessible to ensure a representative population in the data. To select an even number of respondents, an average of 20 households were chosen within each distinct block within a city, for all cities, for all provinces. This helps eliminate bias due to high density populations and ensures even regional representation. However, there were physical limitations faced by data collectors reported in the NFHS, such as the lack of transport and extreme terrain and hills. The team also describes the lack of data for Madhya Pradesh as being caused by communial riots caused by the presence of bandits which needed to be avoided by sampling units. Of course, given the small sample population as compared to the total Indian population, it is not likely that these physical impediments caused any notable data flaws.

# Results

To understand what this data means we will now visualize these findings. Below in Figure 2 is the trend among provinces for women to be married before the age of eighteen and females attending school.

```{r, message=FALSE, warning=FALSE, echo=FALSE, fig.align="center", fig.cap="Attending School vs Married before 18", out.width = '90%'}
dhs |>
  ggplot(aes(`Percent of Females Attending School`, `Percent of Women Married before age eighteen`)) +
  geom_point() +
  geom_smooth(method='lm')
```
As we can see, there is a strong negative linear correlation between attending school and not being a child bride. Below in Figure 3 we investigate contraception use and giving birth in a professional facility.

```{r, message=FALSE, warning=FALSE, echo=FALSE, fig.align="center", fig.cap="Any Contraceptive Use vs. Birth given in a health facility", out.width = '90%'}
dhs |>
  ggplot(aes(`Percent of Women using any Contraceptive Method`, `Percent of Births delivered in Health Facility`)) +
  geom_point() +
  geom_smooth(method='lm')
```
This result shows that the more women have access to contraception (which assumes some knowledge of contraceptive methods), women are more likely to give birth in a professional facility which is far safer. Still, the data shows that the majority of women are not giving birth in a hospital or other delivery setting, which can lead to exposure to germs and infant mortality. Next in Figure 4, we investigate the relationship between literacy and knowledge of contraception methods.

```{r, message=FALSE, warning=FALSE, echo=FALSE, fig.align="center", fig.cap="Toilet Faculties available vs. Infant Mortality Rate", out.width = '90%'}
dhs |>
  ggplot(aes(`Percent of Households with no Toilet Facility`, `Infant Mortality Rate`)) +
  geom_point() +
  geom_smooth(method='lm')
```

Here, we see when a state has a lower proportion of households with no toiler facility, it also has a lower infant mortality rate. This is likely due to the ability for disease to spread without closed-loop septic systems. Finally in Figure 5 we investigate how Fertility varies with Under 5 Mortality rates.

```{r, message=FALSE, warning=FALSE, echo=FALSE, fig.align="center", fig.cap="Total Fertility Rate vs Under 5 Mortality", out.width = '90%'}
dhs |>
  ggplot(aes(`Total Fertility Rate`, `Under 5 Mortality`)) +
  geom_point() +
  geom_smooth(method='lm')
```
\newpage
# Discussion

These findings describe harsh conditions for Indian mothers, and a system that does little to support them. Almost 40% of women are thrust into motherhood before the age of 18, only 31% are able to have their deliveries in a professional setting to minimize risk, many are illiterate, can not attend school, and have over 3 children on average. At it's core, this issue is related to care and support for women to be independent and have access to health information, education and career opportunities, and lives apart from motherhood and wifedom. One problem with this report is the lack of reporting surrounding economic background. As many of India's systemic woman's issues are related to access to resources and poverty, it would have been useful to filter and report across economic strata. This would also help address and understand the dynamics within the castes of India's more prominent social class system, which keeps many people and predominantly women within their familial hierarchy, wherein the only means of mobility is marriage. 

There are several limitations caused by the delivery method of this survey discussed above including difficulty of mobility and bandits. To ensure future surveys can operate at a wider scope, newer DHS initiatives could be run online using an asynchronous question platform. As internet access becomes more ubiquitous across Asia, this delivery method can be used to target younger respondants (a group historically left out of questionnaire populations due to response bias). While the quality and quantity of data can be reduced by online delivery, the cost to respond is also much lower, and can be the most accessible for a very diverse population such as India. For example, it is difficult to transcribe and conduct a survey in many languages due to scarcity of native speakers, but it is easy to translate text online to accomodate many languauges.

Overall, this report presents a quantified view of the difficulty of being an Indian mother. By transcribing and utilizing the final data reported in the DHS NFHS, it is possible to understand the situation for many women and children living in varied conditions. Public policy research and changes should follow from development reports such as this one, which identify opportunities for systemic improvements. In this case, providing more education and employment opportunities to Indian women earlier in life may lead to them having less children and less dependence on traditional patriarchal family structures. This survey program facilitated necessary information, and also proliferated surveying techniques across the country for future reporters to employ, leading to better data-driven policy making for the future. 

\newpage
\appendix

# Appendix {.unnumbered}

## Datasheet {.unnumbered}

**Motivation**

1.  *For what purpose was the dataset created? Was there a specific task in mind? Was there a specific gap that needed to be filled? Please provide a description.*
    -   The report was prepared to understand the state of family affairs and women's health in India in 1992, presumably for public infrastructure and support development initatives. It could also be used to assess financial aid need for specific regions.
2.  *Who created the dataset (for example, which team, research group) and on behalf of which entity (for example, company, institution, organization)?*
    -   Credited contributors include: B.M. Ramesh, Fred Arnold, T.K. Roy, Tara Kanitkar, Pavalavalli Govindsamy, Robert D. Retherford. From the foreword of the report on page 19: "The National Family Health (NFHS) is an important component of the Project to Strengthen the Survey Research Capabilities of the Population Research Centres in India, launched by the Ministry of Health and Family Welfare (MOHFW) in New Delhi in 1991." It was supported by the International Institute for Population Sciences. (IIPS/India (1995))
3.  *Who funded the creation of the dataset? If there is an associated grant, please provide the name of the grantor and the grant name and number.*
    -   From the same foreword as above, "Funding for the NFHS was provided by the United States Agency for International Development (USAID), New Delhi". (IIPS/India (1995))
4.  *Any other comments?*
    -   This survey was launched to address a lack of information regarding family health and growth throughout India. It was the first of it's kind to be performed across the entire subcontinent. By performing this kind of large-scale analysis, it allows policy makers to understand the state of the nation to best address large issues.

**Composition**

1.  *What do the instances that comprise the dataset represent (for example, documents, photos, people, countries)? Are there multiple types of instances (for example, movies, users, and ratings; people and interactions between them; nodes and edges)? Please provide a description.*
    -   In the context of this large dataset, splits exist to seperate provinces as distinct populations. As such, each instance maps to one of the 26 Indian states or provinces. These instances are cast across the geographic splits: North, Northeast, West, East, South, and Central.
2.  *How many instances are there in total (of each type, if appropriate)?*
    -   There are 26 instances or states.
3.  *Does the dataset contain all possible instances or is it a sample (not necessarily random) of instances from a larger set? If the dataset is a sample, then what is the larger set? Is the sample representative of the larger set (for example, geographic coverage)? If so, please describe how this representativeness was validated/verified. If it is not representative of the larger set, please describe why not (for example, to cover a more diverse range of instances, because instances were withheld or unavailable).*
    -   The dataset includes all possible instances as of writing this report. Since 1992, there have been three new demarcated provinces which are not included in this dataset.
4.  *What data does each instance consist of? "Raw" data (for example, unprocessed text or images) or features? In either case, please provide a description.*
    -   Each instance includes 23 continuous variables, which can be viewed in detail in the `/outputs/data/cleaned_data.csv` file.
5.  *Is there a label or target associated with each instance? If so, please provide a description.*
    -   The first column defines the instance or state where the population was sampled.
6.  *Is any information missing from individual instances? If so, please provide a description, explaining why this information is missing (for example, because it was unavailable). This does not include intentionally removed information, but might include, for example, redacted text.*
    -   The following 5 states are missing data for at least one of the following columns: `Percent of children stunted`, `Percent of children Wasted`, `Percent of Children receiving Breastmilk and Solid Food`: Delhi, Himachal Pradesh, West Bengal, Andhra Pradesh, and Tamil Nadu, which are due to unavailable data.
7.  *Are relationships between individual instances made explicit (for example, users' movie ratings, social network links)? If so, please describe how these relationships are made explicit.*
    -   There are no described relationships between individual instances. In this case, all data is assumed to be unrelated and uncorrelated (which is of course overidealized).
8.  *Are there recommended data splits (for example, training, development/validation, testing)? If so, please provide a description of these splits, explaining the rationale behind them.*
    -   There are no reccomended splits.
9.  *Are there any errors, sources of noise, or redundancies in the dataset? If so, please provide a description.*
    -   There are no errors, sources of noise, or redundancies to note because the raw dataset is not available for readers.
10. *Is the dataset self-contained, or does it link to or otherwise rely on external resources (for example, websites, tweets, other datasets)? If it links to or relies on external resources, a) are there guarantees that they will exist, and remain constant, over time; b) are there official archival versions of the complete dataset (that is, including the external resources as they existed at the time the dataset was created); c) are there any restrictions (for example, licenses, fees) associated with any of the external resources that might apply to a dataset consumer? Please provide descriptions of all external resources and any restrictions associated with them, as well as links or other access points, as appropriate.*
    -   The dataset is self-contained.
11. *Does the dataset contain data that might be considered confidential (for example, data that is protected by legal privilege or by doctor-patient confidentiality, data that includes the content of individuals' non-public communications)? If so, please provide a description.*
    -   There is no confidential data.
12. *Does the dataset contain data that, if viewed directly, might be offensive, insulting, threatening, or might otherwise cause anxiety? If so, please describe why.*
    -   The column `Percent of children Wasted` may be considered offensive and insulting as the publishing team asserts that these malnourished children are of no value. It's hard to describe why this is offensive, but I know it offends me.
13. *Does the dataset identify any sub-populations (for example, by age, gender)? If so, please describe how these subpopulations are identified and provide a description of their respective distributions within the dataset.*
    -   The dataset identifies sub population by age and gender. Women between 13-29 are surveyed from 24 states in Delhi. Also, children under 5 are represented here as column data.
14. *Is it possible to identify individuals (that is, one or more natural persons), either directly or indirectly (that is, in combination with other data) from the dataset? If so, please describe how.*
    -   There is no way to identify individuals from the prepared statistics.
15. *Does the dataset contain data that might be considered sensitive in any way (for example, data that reveals race or ethnic origins, sexual orientations, religious beliefs, political opinions or union memberships, or locations; financial or health data; biometric or genetic data; forms of government identification, such as social security numbers; criminal history)? If so, please provide a description.*
    -   This information pertains to the treatment of Indian women and children, in a society where those two groups are underprivileged. As such, most interpretations of this dataset should be considered sensitive. Sensitive columns include: `Percent of children Wasted` due to the implication this data has on human life. The authors assert severely malnourished children are of no value and are not worth developing which is off putting. Further religious affiliation, a topic which sparked a genocide half a century before this report was published, is presented here. As such any interpretations of this religious information could cause social tension domestically.

**Collection process**

1.  *How was the data associated with each instance acquired? Was the data directly observable (for example, raw text, movie ratings), reported by subjects (for example, survey responses), or indirectly inferred/derived from other data (for example, part-of-speech tags, model-based guesses for age or language)? If the data was reported by subjects or indirectly inferred/derived from other data, was the data validated/verified? If so, please describe how.*
    -   Data for each instance was reported by individuals living in each of the 25 states by response takers before being compiled.
2.  *What mechanisms or procedures were used to collect the data (for example, hardware apparatuses or sensors, manual human curation, software programs, software APIs)? How were these mechanisms or procedures validated?*
    -   Interviews of volunteers across India, with little modern technology except for pens and maybe computer tabulation.
3.  *If the dataset is a sample from a larger set, what was the sampling strategy (for example, deterministic, probabilistic with specific sampling probabilities)?*
    -   The strategy was geographically focused, and the data is divided into each state and region, and further into village size, distance from nearest town, proportion of nonagricultural workers, proportion of the population belonging to scheduled castes, and female literacy. The publication discusses how primary sampling units were selected systematically, with probability proportional to size of the strata.
4.  *Who was involved in the data collection process (for example, students, crowdworkers, contractors) and how were they compensated (for example, how much were crowdworkers paid)?*
    -   Response takers were supervised by senior field staff in each state. There is no compensation data or information about how these surveys were implemented.
5.  *Over what timeframe was the data collected? Does this timeframe match the creation timeframe of the data associated with the instances (for example, recent crawl of old news articles)? If not, please describe the timeframe in which the data associated with the instances was created.*
    -   From April 1992 to September 1993, over 16 months.
6.  *Were any ethical review processes conducted (for example, by an institutional review board)? If so, please provide a description of these review processes, including the outcomes, as well as a link or other access point to any supporting documentation.*
    -   Ethical review processes were not discussed in this publication, although the DHS has an advisory board and is funded through a government subsidy.
7.  *Did you collect the data from the individuals in question directly, or obtain it via third parties or other sources (for example, websites)?*
    -   This data was retrieved from: <https://dhsprogram.com/publications/publication-frind1-dhs-final-reports.cfm>.
8.  *Were the individuals in question notified about the data collection? If so, please describe (or show with screenshots or other information) how notice was provided, and provide a link or other access point to, or otherwise reproduce, the exact language of the notification itself.*
    -   Repondents volunteered their data. No notice of data collection is included in the publication.
9.  *Did the individuals in question consent to the collection and use of their data? If so, please describe (or show with screenshots or other information) how consent was requested and provided, and provide a link or other access point to, or otherwise reproduce, the exact language to which the individuals consented.*
    -   Respondents consented to data collections and use of their information, although this is not explained in detail in the publication.
10. *If consent was obtained, were the consenting individuals provided with a mechanism to revoke their consent in the future or for certain uses? If so, please provide a description, as well as a link or other access point to the mechanism (if appropriate).*
    -   No mechanism to revoke consent was provided.
11. *Has an analysis of the potential impact of the dataset and its use on data subjects (for example, a data protection impact analysis) been conducted? If so, please provide a description of this analysis, including the outcomes, as well as a link or other access point to any supporting documentation.*
    -   As this data is anonymity, and 30 years old, this is perhaps not necessary. Still, one was not conducted given the scope of work.

**Preprocessing/cleaning/labeling**

1.  *Was any preprocessing/cleaning/labeling of the data done (for example, discretization or bucketing, tokenization, part-of-speech tagging, SIFT feature extraction, removal of instances, processing of missing values)? If so, please provide a description. If not, you may skip the remaining questions in this section.*
    -   The data was prepared by the DHS team prior to publication, and the transcription of this polished data was done using an R library called `pdftools` (Ooms (2022)) using an OCR engine.
2.  *Was the "raw" data saved in addition to the preprocessed/cleaned/labeled data (for example, to support unanticipated future uses)? If so, please provide a link or other access point to the "raw" data.*
    -   Raw data can be found here: <https://github.com/nkhi/paper4/blob/main/outputs/data/raw_data.csv>.
3.  *Is the software that was used to preprocess/clean/label the data available? If so, please provide a link or other access point.*
    -   All analysis was done using R which is avalaible at <https://www.R-project.org/>.

**Uses**

1.  *Has the dataset been used for any tasks already? If so, please provide a description.*
    -   It was used to publish the DHS Family Health Survey in 1992-1993, and there have likely been many uses of this information in public and political spheres. In the context of this report, it was used to prepare this document and to create the visualizations included.
2.  *Is there a repository that links to any or all papers or systems that use the dataset? If so, please provide a link or other access point.*
    -   No. However, if there are any "forks" of <https://github.com/nkhi/paper4> accessible on Github, then there may be an extension or use of this work.
3.  *What (other) tasks could the dataset be used for?*
    -   This dataset should be used for understanding and analyzing the state of family growth and women's health in India from 1992-1993. Without applying the context of the investigation to further uses of this dataset, and ensuring it is relevant, this dataset shouldn't be used.
4.  *Is there anything about the composition of the dataset or the way it was collected and preprocessed/cleaned/labeled that might impact future uses? For example, is there anything that a dataset consumer might need to know to avoid uses that could result in unfair treatment of individuals or groups (for example, stereotyping, quality of service issues) or other risks or harms (for example, legal risks, financial harms)? If so, please provide a description. Is there anything a dataset consumer could do to mitigate these risks or harms?*
    -   The use of an OCR engine to transcribe PDF tables means errors could arise from incorrect interpretation. All other aspects of this analysis are static in nature and do not give rise to future issues.
5.  *Are there tasks for which the dataset should not be used? If so, please provide a description.*
    -   Anything outside of the scope of family health in India in 1992-1993.

**Distribution**

1.  *Will the dataset be distributed to third parties outside of the entity (for example, company, institution, organization) on behalf of which the dataset was created? If so, please provide a description.*
    -   The dataset is available for all public use under the MIT license.
2.  *How will the dataset be distributed (for example, tarball on website, API, GitHub)? Does the dataset have a digital object identifier (DOI)?*
    -   It is distributed through Github.
3.  *When will the dataset be distributed?* -It will be distributed in April, 2022.
4.  *Will the dataset be distributed under a copyright or other intellectual property (IP) license, and/or under applicable terms of use (ToU)? If so, please describe this license and/ or ToU, and provide a link or other access point to, or otherwise reproduce, any relevant licensing terms or ToU, as well as any fees associated with these restrictions.*
    -   The dataset has minimal IP/copyright restrictions under the MIT license.
5.  *Have any third parties imposed IP-based or other restrictions on the data associated with the instances? If so, please describe these restrictions, and provide a link or other access point to, or otherwise reproduce, any relevant licensing terms, as well as any fees associated with these restrictions.*
    -   No.
6.  *Do any export controls or other regulatory restrictions apply to the dataset or to individual instances? If so, please describe these restrictions, and provide a link or other access point to, or otherwise reproduce, any supporting documentation.*
    -   No.

**Maintenance**

1.  *Who will be supporting/hosting/maintaining the dataset?*
    -   Nikhi Bhambra.
2.  *How can the owner/curator/manager of the dataset be contacted (for example, email address)?*
    -   Can be contacted via email at [heynikhi\@gmail.com](mailto:heynikhi@gmail.com){.email} or on Github.
3.  *Is there an erratum? If so, please provide a link or other access point.*
    -   No.
4.  *Will the dataset be updated (for example, to correct labeling errors, add new instances, delete instances)? If so, please describe how often, by whom, and how updates will be communicated to dataset consumers (for example, mailing list, GitHub)?*
    -   Not after April 10th. Any updates will be completed using Github and Git at the repository provided, with context in the commit log.
5.  *If the dataset relates to people, are there applicable limits on the retention of the data associated with the instances (for example, were the individuals in question told that their data would be retained for a fixed period of time and then deleted)? If so, please describe these limits and explain how they will be enforced.*
    -   There are no limits as this data was compiled from volunteered responses.
6.  *Will older versions of the dataset continue to be supported/hosted/maintained? If so, please describe how. If not, please describe how its obsolescence will be communicated to dataset consumers.*
    -   Yes, the history of the dataset files will remain on Github. However the data was finalized when the report was published, so values should not change except to respond to a recording error.
7.  *If others want to extend/augment/build on/contribute to the dataset, is there a mechanism for them to do so? If so, please provide a description. Will these contributions be validated/verified? If so, please describe how. If not, why not? Is there a process for communicating/distributing these contributions to dataset consumers? If so, please provide a description.*
    -   Any extensions can be made to the public repository on Github in the form of a pull request.

## Reproducibility {.unnumbered}

This section explains what each part of the project repository does.

You can run this analysis end-to-end by cloning the repository using `git`: <https://github.com/nkhi/paper4>. 

-   `00-simulation.r` creates simulated population data to help develop a plan for treatment and analysis.
-   `01-gather_data.r` transcribes the report pages using the `pdftools` (Ooms (2022)) library OCR engine.
-   `02-clean_and_prepare.r` finalizes and prepares the transcribed tables for use in the analysis.
-   `report/paper4.rmd` contains the R code, and markdown report content for this analysis.

The report utilizes each of the scripts to run an analysis workflow, and by running this report, you will reproduce the relevant datasheets within the `~/outputs/data/` directory. The PDF used in `01-gather-data.r` is available at `~/inputs/literature/`.

To run this repo open `~/report/paper.Rmd` in RStudio or another RMarkdown interpreter. Run the file, which will trigger the included script files and generate `~/report/paper4.pdf`. Each of the script files can be run by un-commenting the final line in each `scripts/*.R` file.

\newpage
# References

---
nocite: |
  @@citeddknitr, @citeR, @nfhs, @citepdftools @citepointblank
---


<!-- 
---
title: "What makes a good basketball player? How player heights and weights influence performance statistics in the NBA."
author: "Nikhil Bhambra | Feb 20th, 2022"
output: pdf_document
---

```{r echo=FALSE}

# Code used to make dataset.csv
# all data sheets
# perf <- read.csv('./performance.csv')
# attr <- read.csv('./attributes.csv')

# attr but just height/weight
# attr_small <- select(attr, 'FULL.NAME', HEIGHT, WEIGHT)

# join on name to get heights/weights
# all <- merge(perf, attr_small, by="FULL.NAME")

# drop NA, 613 values. Drop dups, 551 values.
# all_sm <- na.omit(all)
# final_dataset <- all_sm %>% distinct(FULL.NAME, .keep_all=TRUE)

# output
# write.csv(final_dataset, "./dataset.csv")

# IMPORT DATASET.
all_sm <- read.csv("./dataset.csv")
```

# Proposed Research Question

- Which performance statistics in professional basketball are influenced by player height and weight? Are there significant linear relationships between in-game performance and physical stature across a population? 

- For those statistics which do not have a clear linear association with height or weight on a population-level, are there any significant trends across or within distinct strata found in splits of another categorical variables such as position, team, or years of experience?

# Background Information and Relevance

The National Basketball Association only recruits elite basketball players from across the globe. As of this season (2021-2022), there are roughly 600 athletes playing on 30 teams spread across the United States of America. I'm interested in seeing how the physical makeup of the league influences player performance. In other words, does a players height or weight necessarily affect their scoring or defensive abilities relative to other players? NBA Teams value specific physical traits as well as in-game savvy when selecting recruits, and the height of players has steadily risen over the past decades (Curcic, 2017). Interestingly, current trends in the league indicate a decrease in priority for singularly tall players, while the average height for each position in the NBA has stayed significantly above 69 inches, the average height of a male in the USA (Fryer et al., 2021). I am interested to see if the current decreasing priority for tall players is reflected in a less-intense linear trend for height as it relates to other performance statistics. Figures below courtesy of Curcic, 2017 shows this trend over time.

\

![Average height of NBA Players by position over time](./new-avgheight.png)
![Average weight of NBA Players by position over time](./new-avgweight.png)

# Exploratory Data Analysis

## Data Source and Description

To begin, I sourced data from `nbastuffer.com` (www.nbastuffer.com, 2022) and `nba.com/stats` (NBA Statistics Team, 2022) which both maintain publicly accessible and frequently-updated stats for NBA player performance. Information on performance including points-per-game (PPG), usage in minutes, and compiled statistics standard in the sport such as effective-shooting percentage were found on `nbastuffer.com`. To investigate these performance metrics with respect to height and weight, I had to scrape the `nba.com/stats` website which maintains these attributes. I did so by intercepting the response JSON file which is sent to the user's browser to display player stats on the web page. I converted this JSON to a CSV, and joined this information with the `nbastuffer` info, based on player names. At this point, I removed rows with null values, and removed duplicate names caused by players switching teams mid-season. My population contains 551 observations representing distinct players active in the NBA this season. The data has the following columns:

Column Name | Meaning
----|----------------
X    |    Unique Integer ID (1..557)
Full Name     |    First and Last Name
Height    | Height of the player in inches
Weight    | Weight of the player in pounds
Team    |   Current team
Position    | Primary position
Age    |  Age in years
GP*    |   Games played
MPG*    |  Minutes per game
MIN*    |  Minutes played percentage
USG*    |  Usage percentage
TO*    |   Turnover rate 
FTA*    |  Free-throws attempted
FT*    |   Free-throws percentage
X2PA*    | 2-point shot attempts
X2P*    |  2-point percentage
X3PA*    | 3-point shot attempts
X3P*    |  3-point percentage
eFG*    |  Effective Shooting Percentage
TS*    |   True Shooting Percentage
PPG*    | Points Per Game
RPG*    | Rebounds Per Game
TRB*    | Total Rebound Percentage
APG*    | Assists per game
AST*    | Assist percentage
SPG*    | Steals per game
BPG*    | Blocks per game
TOP*    | Turnovers per game
VI*    | "Versatility Rating"
ORTG* | "Offensive Rating" Points produced per every 100 possessions
DRTG*    | "Defensive Rating Points allowed by the player in head-ons per 100 possessions

\newpage 

I want to use Height and Weight as potential linear predictors to estimate the performance statistics. They're both normally distributed, which is important because I would like my predictor to be roughly normal as the sample size increases to ensure the assumptions of a linear model are satisfied.

```{r echo=FALSE, fig.cap="Distributions of stature measures across NBA players are Normal", fig.height=4, fig.width=8}
par(mfrow=c(1,2))
hist(all_sm$HEIGHT, main="Height (inches)", xlab="Frequency (n. players)")
hist(all_sm$WEIGHT, main="Weight (pounds)", xlab="Frequency (n. players)")
```

Many of the performance statistics are either numeric ranges, or percentages where the range of values is distributed between 0 & 1. Of these variables, I performed exploration on the columns in the table with asterisks (*) next to their names. Each of these statistics measures a different aptitude which elite players are often evaluated on (for example, offensive statistics such as steals, points-per-game, and 3-shot percentage are significant predictors for Point Guard valuation). In examining all of these attributes against height and weight to evaluate if a trend exists, I was able to dismiss any potential estimators which do not exhibit a strong linear correlation with either height or weight. 

For example, my first choice for performance indicator is PPG (points-per-game), but in this population there is no clear linear association between height or weight, which can be seen below. For these attributes, which include PPG or Turnovers for example, I plan to try and investigate if there are significant strata witin this attribute for which to associate with height/weight. It may yield interesting results if I control for a specific categorical factor (ex: only international players) to see how these trends vs. height and weight compare.

```{r echo=FALSE, fig.cap="Failed linear association: PPG", fig.height=4, fig.width=8}
par(mfrow=c(1,2))
a <- lm(all_sm$WEIGHT ~ all_sm$PPG)
plot(all_sm$WEIGHT ~ all_sm$PPG, main="PPG vs. Weight", xlab="Weight (pounds)", ylab="PPG")
abline(a, col="red")

b <- lm(all_sm$HEIGHT ~ all_sm$PPG)
plot(all_sm$HEIGHT ~ all_sm$PPG, main="PPG vs. Height", xlab="Height (inches)", ylab="PPG")
abline(b, col="blue")
```

\newpage

## Selected Variables and Potential Investigations

After checking the relationships between all the performance variables w.r.t both weight and height, I believe the eight (8) factors below show potentially significant linear relationships with height or weight. While some of these scatterplots w.r.t height and weight have a random, cloud-like clustering of points towards the middling values, they all exhibit some positive or negative relationship which is significant at a population level. I will investigate these plots, as well as any relationships within the strata found within these variables if applicable. 

- eFG: Effective Shooting Percentage
- TS: True Shooting Percentage
- X2P. - 2-point shooting percentage
- X3P. - 3-point shooting percentage
- BPG: Blocks per Game
- SPG: Steals per Game
- DRTG: Defensive Rating
- ORTG: Offensive Rating


```{r echo=FALSE, fig.cap="Potential linear assoc: Effective Shooting Percentage", fig.height=5, fig.width=10}
# eFG
par(mfrow=c(1,2))
c <- lm(all_sm$WEIGHT ~ all_sm$eFG.Effective.Shooting.PercentageWith.eFG...three.point.shots.made.are.worth.50..more.than.two.point.shots.made..eFG..Formula..FGM...0.5.x.3PM...FGA)
plot(all_sm$WEIGHT ~ all_sm$eFG.Effective.Shooting.PercentageWith.eFG...three.point.shots.made.are.worth.50..more.than.two.point.shots.made..eFG..Formula..FGM...0.5.x.3PM...FGA, main="eFG vs. Weight", xlab="Weight (pounds)", ylab="eFG")
abline(c, col="red")

d <- lm(all_sm$HEIGHT ~ all_sm$eFG.Effective.Shooting.PercentageWith.eFG...three.point.shots.made.are.worth.50..more.than.two.point.shots.made..eFG..Formula..FGM...0.5.x.3PM...FGA)
plot(all_sm$HEIGHT ~ all_sm$eFG.Effective.Shooting.PercentageWith.eFG...three.point.shots.made.are.worth.50..more.than.two.point.shots.made..eFG..Formula..FGM...0.5.x.3PM...FGA, main="eFG vs. Height", xlab="Height (inches)", ylab="eFG")
abline(d, col="blue")
```

```{r echo=FALSE, fig.cap="Potential linear assoc: True Shooting Percentage", fig.height=5, fig.width=10}
# TS
par(mfrow=c(1,2))
e <- lm(all_sm$WEIGHT ~ all_sm$TS.True.Shooting.PercentageTrue.shooting.percentage.is.a.measure.of.shooting.efficiency.that.takes.into.account.field.goals..3.point.field.goals..and.free.throws.)
plot(all_sm$WEIGHT ~ all_sm$TS.True.Shooting.PercentageTrue.shooting.percentage.is.a.measure.of.shooting.efficiency.that.takes.into.account.field.goals..3.point.field.goals..and.free.throws., main="TS vs. Weight", xlab="Weight (pounds)", ylab="True Shooting Percentage")
abline(e, col="red")

f <- lm(all_sm$HEIGHT ~ all_sm$TS.True.Shooting.PercentageTrue.shooting.percentage.is.a.measure.of.shooting.efficiency.that.takes.into.account.field.goals..3.point.field.goals..and.free.throws.)
plot(all_sm$HEIGHT ~ all_sm$TS.True.Shooting.PercentageTrue.shooting.percentage.is.a.measure.of.shooting.efficiency.that.takes.into.account.field.goals..3.point.field.goals..and.free.throws., main="eFG vs. Height", xlab="Height (inches)", ylab="True Shooting Percentage")
abline(f, col="blue")
```

```{r echo=FALSE, fig.cap="Potential linear assoc: 2-point shooting percentage", fig.height=5, fig.width=10}
# X2P
par(mfrow=c(1,2))
g <- lm(all_sm$WEIGHT ~ all_sm$X2P.)
plot(all_sm$WEIGHT ~ all_sm$X2P., main="2P% vs. Weight", xlab="Weight (pounds)", ylab="2-point shooting percentage")
abline(g, col="red")

h <- lm(all_sm$HEIGHT ~ all_sm$X2P.)
plot(all_sm$HEIGHT ~ all_sm$X2P., main="2P% vs. Height", xlab="Height (inches)", ylab="2-point shooting percentage")
abline(h, col="blue")
```

```{r echo=FALSE, fig.cap="Potential linear assoc: 3-point shooting percentage", fig.height=5, fig.width=10}
# X3P.
par(mfrow=c(1,2))
i <- lm(all_sm$WEIGHT ~ all_sm$X3P.)
plot(all_sm$WEIGHT ~ all_sm$X3P., main="3P% vs. Weight", xlab="Weight (pounds)", ylab="2-point shooting percentage")
abline(i, col="red")

j <- lm(all_sm$HEIGHT ~ all_sm$X3P.)
plot(all_sm$HEIGHT ~ all_sm$X3P., main="3P% vs. Height", xlab="Height (inches)", ylab="3-point shooting percentage")
abline(j, col="blue")
```

```{r echo=FALSE, fig.cap="Potential linear assoc: Blocks per game", fig.height=5, fig.width=10}
# BPG
par(mfrow=c(1,2))
k <- lm(all_sm$WEIGHT ~ all_sm$BPGBlocksBlocks.per.game.)
plot(all_sm$WEIGHT ~ all_sm$BPGBlocksBlocks.per.game., main="BPG vs. Weight", xlab="Weight (pounds)", ylab="Blocks per game")
abline(k, col="red")

l <- lm(all_sm$HEIGHT ~ all_sm$BPGBlocksBlocks.per.game.)
plot(all_sm$HEIGHT ~ all_sm$BPGBlocksBlocks.per.game., main="BPG vs. Height", xlab="Height (inches)", ylab="Blocks per game")
abline(l, col="blue")
```

```{r echo=FALSE, fig.cap="Potential linear assoc: Steals per game", fig.height=5, fig.width=10}
# SPG
par(mfrow=c(1,2))
x <- lm(all_sm$WEIGHT ~ all_sm$SPGStealsSteals.per.game.)
plot(all_sm$WEIGHT ~ all_sm$SPGStealsSteals.per.game., main="BPG vs. Weight", xlab="Weight (pounds)", ylab="Blocks per game")
abline(x, col="red")

z <- lm(all_sm$HEIGHT ~ all_sm$SPGStealsSteals.per.game.)
plot(all_sm$HEIGHT ~ all_sm$SPGStealsSteals.per.game., main="BPG vs. Weight", xlab="Weight (pounds)", ylab="Blocks per game")
abline(z, col="blue")
```

```{r echo=FALSE, fig.cap="Potential linear assoc: Defensive rating", fig.height=5, fig.width=10}
# DEFRTG
par(mfrow=c(1,2))
x <- lm(all_sm$WEIGHT ~ all_sm$DRTGDefensive.RatingIndividual.defensive.rating.estimates.how.many.points.the.player.allowed.per.100.possessions.he.individually.faced.while.staying.on.the.court.)
plot(all_sm$WEIGHT ~ all_sm$DRTGDefensive.RatingIndividual.defensive.rating.estimates.how.many.points.the.player.allowed.per.100.possessions.he.individually.faced.while.staying.on.the.court., main="D.RTG vs. Weight", xlab="Weight (pounds)", ylab="Defensive rating")
abline(x, col="red")

z <- lm(all_sm$HEIGHT ~ all_sm$DRTGDefensive.RatingIndividual.defensive.rating.estimates.how.many.points.the.player.allowed.per.100.possessions.he.individually.faced.while.staying.on.the.court.)
plot(all_sm$HEIGHT ~ all_sm$DRTGDefensive.RatingIndividual.defensive.rating.estimates.how.many.points.the.player.allowed.per.100.possessions.he.individually.faced.while.staying.on.the.court., main="D.RTG vs. Height", xlab="Height (inches)", ylab="Defensive rating")
abline(z, col="blue")
```

```{r echo=FALSE, fig.cap="Potential linear assoc: Offensive rating", fig.height=5, fig.width=10}
# OFFRTG
par(mfrow=c(1,2))
x <- lm(all_sm$WEIGHT ~ all_sm$ORTGOffensive.RatingIndividual.offensive.rating.is.the.number.of.points.produced.by.a.player.per.100.total.individual.possessions.)
plot(all_sm$WEIGHT ~ all_sm$ORTGOffensive.RatingIndividual.offensive.rating.is.the.number.of.points.produced.by.a.player.per.100.total.individual.possessions., main="O.RTG vs. Pounds", xlab="Weight (pounds)", ylab="Offensive rating")
abline(x, col="red")

z <- lm(all_sm$HEIGHT ~ all_sm$ORTGOffensive.RatingIndividual.offensive.rating.is.the.number.of.points.produced.by.a.player.per.100.total.individual.possessions.)
plot(all_sm$HEIGHT ~ all_sm$ORTGOffensive.RatingIndividual.offensive.rating.is.the.number.of.points.produced.by.a.player.per.100.total.individual.possessions., main="D.RTG vs. Height", xlab="Height (inches)", ylab="Offensive rating")
abline(z, col="blue")
```

\newpage
## Discussion of Linear Regression Models

I am trying to see if any of the performance based statistics which are standard in measuring players are associated with the player's height and weight. Traditionally, basketball has been a game dominated in the professional setting by taller players due to natural advantage it gives for shooting and defending. However these simple concepts do not always translate to in-game performance. In this case, all of the selected potential variables of interest show some population-wide linear trend with height and or weight. I will continue with this analysis, suplimenting it with context from the NBA to establish the significance of these trends within the context of game performance.

# References

Curcic, Dimitrije. “67 Years of Height Evolution in the NBA - In-Depth Research.” Athletic Shoe Reviews, RunRepeat.com, 2017, runrepeat.com/height-evolution-in-the-nba.

Fryar CD, Carroll MD, Gu Q, Afful J, Ogden CL (January 2021). "Anthropometric Reference Data for Children and Adults: United States, 2015-2018" (PDF). Vital & Health Statistics. Series 3, Analytical and Epidemiological Studies. 11 (36): 1–44. PMID 33541517.

NBA Statistics Team. “Players Bios.” NBA Stats, National Basketball Association, 18 Feb. 2022, www.nba.com/stats/players/bio/.

“NBA Stats 2021/22: All Player Statistics in One Page.” Www.nbastuffer.com, nbastuffer, 20 Oct. 2021, www.nbastuffer.com/2021-2022-nba-player-stats/.

~~!!!!!!!!!!!!!!!!!!!!!!!!

---
title: "STA302 Analysis: Admissions Rates vs various social factors"
authors: Disha Bobby and Nikhi Bhambra
output: html_notebook
---

First investigate which features exhibit roughly normal distributions and explore residuals.

```{r}
library(tidyverse)

# Import data set
data <- read.csv("VPdataset.csv")

#Histogram of all continuous variables 
hist_names <- c("a", "b", "c", "Number of branch campuses", "d", "e", "f", 
                "g", "h", "i", "j", "Admission Rate", "Avg Cost of Attendance",
               "Average faculty salary", "Proportion of full-time faculty members",
               "% of Undergrads with Pell grant", "% of Undergrads > 25 years", 
                "% of Aided Students w/ family income <$30,000", "% of first-generation students",
               "% of Female Students", "Median Family Income", "% of White persons in students' zip codes",
               "% of Black persons in students' zip codes", "% of Asian persons from students' zip codes",
               "% of the Hispanic persons from students' zip codes", "% of Individuals w/ a bachelor's degree in zip codes ",
               "% of Individuals w/ a Professional Degree in zip codes", "% of US Citizens in students' zip codes",
               "Poverty Rate", "Unemployment Rate")

# There seems to be a skew in the response and most of the predictor variables except in "Percentage of First-Generation Students" and "% of Individuals with a Bachelor's Degree in student's neighbourhood". This could indicate a violation of normality. 
par(mfrow=c(2,2))
for(i in c(4, 12: 30)){
  hist(data[,i], main=substitute(paste('Histogram of ', a), list(a=hist_names[i])), xlab = " ", cex.main=0.75)
}

# Create model with all continuous predictors
model <- lm(ADM_RATE ~ ., data= data[, c(4, 12:30)])
summary(model)

#Check conditions
pairs(data[, c(12:17)])
pairs(data[, c(12, 18:22)])
pairs(data[, c(12, 23:27)])
pairs(data[, c(12, 27:30)])

# Y vs Yhat
plot(data$ADM_RATE ~ fitted(model), main="Y versus Yhat", ylab="response", xlab="yhat") # Points seem to be scattered evenly around the 45 degrees line for lower values of of the fitted values but the spread increases for higher values of the fitted values.

# Residuals vs Fitted
# par(mfrow=c(2,2))
plot(residuals(model) ~ fitted(model), main="Residuals v fitted", xlab="fitted", ylab="residuals")
for(i in 12:30){
plot(residuals(model) ~ data[,i], main=substitute(paste('Residuals v ', a), list(a=hist_names[i])), xlab=" ", ylab="residuals", cex.main=0.75)
}
```
As we can see, they are not very random, with harsh skews.

View QQ plots. They are roughly linear with high variance at the right tail.

```{r}
## QQ plots
qqnorm(residuals(model))
qqline(residuals(model))
```
Next, apply transformations to address vialoted conditions.

```{r}
# APPLY POWER TRANSFORMATIONS AND WORK WITH CORRECTED DATA

# Do Corrections
 install.packages("car")
library(car)
data2<-data %>% mutate(MD_FAMINC = ifelse(MD_FAMINC==0, 0.5, MD_FAMINC))
power_transform <- powerTransform(cbind(data2[, c(4, 12:30)]))
# summary(power_transform)
```
```{r}
data2$ADM_RATE <- data2$ADM_RATE^1.44
data2$COSTT4_A <- data2$COSTT4_A^0.5
data2$AVGFACSAL <- data2$AVGFACSAL^0.5
data2$PCTPELL <- data2$PCTPELL^0.5
data2$UG25ABV <- data2$UG25ABV^0.27
data2$INC_PCT_LO <- data2$INC_PCT_LO^0.26
data2$PAR_ED_PCT_1STGEN <- data2$PAR_ED_PCT_1STGEN^0.66
data2$FEMALE <- data2$FEMALE^1.6
data2$MD_FAMINC <- data2$MD_FAMINC^0.5
data2$PCT_WHITE <- data2$PCT_WHITE^3.22
data2$PCT_BLACK <- data2$PCT_BLACK^0.43
data2$PCT_ASIAN <- log(data2$PCT_ASIAN)
data2$PCT_HISPANIC <- log(data2$PCT_HISPANIC)
data2$PCT_GRAD_PROF <- log(data2$PCT_GRAD_PROF)
data2$PCT_BORN_US <- data2$PCT_BORN_US^10.35
data2$POVERTY_RATE <- data2$POVERTY_RATE^-0.33
data2$UNEMP_RATE <- data2$UNEMP_RATE^-0.78
```

After applying corrections, refit a model and investigate how the model variance has changed.

```{r}
#re-fit full model with same predictors
full2<- lm(ADM_RATE ~ ., data= data2[, c(4, 12:30)])
summary(full2)
# anova(model, full2)

#re-check assumptions
pairs(data2[, c(12:17)])
pairs(data2[, c(12, 18:22)])
pairs(data2[, c(12, 23:27)])
pairs(data2[, c(12, 27:30)])

# Y vs Yhat
plot(data2$ADM_RATE ~ fitted(full2), main="Y versus Yhat", ylab="response", xlab="yhat") # Points seem to be scattered evenly around the 45 degrees line for lower values of of the fitted values but the spread increases for higher values of the fitted values.

# Residuals vs fitted after corrections
par(mfrow=c(2,2))
plot(residuals(full2) ~ fitted(full2), main="Residuals v fitted", xlab="fitted", ylab="residuals")
for(i in 12:30){
  plot(residuals(full2) ~ data2[,i], main=substitute(paste('Residuals v ', a), list(a=hist_names[i])), xlab=" ", ylab="residuals", cex.main=0.75)
}
```

These residual plots are much more random clouds.

New QQ plots. This displays less overall variance, but with more equal skews in the left and right tails post-adjustment. Observe the Theoretical value=2 on this plot versus the pre-corrected dataset version.

```{r}
# New QQ plots
qqnorm(residuals(full2))
qqline(residuals(full2))
```

After correcting these features, we can now continuously test reduced versions of the first model. By using a t-test to conclude if coefficients are significantly related to the response, we can find a more accurate model which includes less noise.

```{r}
# MAKE LINEAR MODEL WITH NEW CORRECTED DATA

#Based on the t-values (and a cut off of Pr(>|t|) = 0.6), smaller model without PBI, PFTFAC, UG25ABV, INC_PCT_LO
# `model` is defined above, it contains all continuous predictors, with an r^2= 
model1 <- lm(ADM_RATE ~ NUMBRANCH + as.factor(CONTROL) + as.factor(REGION) + HBCU + TRIBAL + HSI + WOMENONLY + COSTT4_A + AVGFACSAL + PCTPELL +  INC_PCT_LO + PAR_ED_PCT_1STGEN + FEMALE + MD_FAMINC + PCT_WHITE + PCT_BLACK + PCT_ASIAN + PCT_HISPANIC + 
               PCT_BA + PCT_GRAD_PROF + PCT_BORN_US + POVERTY_RATE + UNEMP_RATE, data=data2)
summary(model1) # r^2 = 0.2644
# Partial f-test result
anova(model1, model)

# Smaller model without PCT_BORN_US, POVERTY_RATE, UNEMP_RATE, PCT_ASIAN, INC_PCT_LO, UG25ABV, PCT_BLACK, & PCT_PELL
model2 <- lm(ADM_RATE ~ NUMBRANCH + as.factor(CONTROL) + as.factor(REGION) + TRIBAL + HSI + WOMENONLY + COSTT4_A + AVGFACSAL + PFTFAC + 
               PAR_ED_PCT_1STGEN + FEMALE + MD_FAMINC + PCT_WHITE + PCT_HISPANIC + PCT_BA + PCT_GRAD_PROF, data=data2)
summary(model2) # r^2 0.2535 p very small

# Partial f-test result
anova(model2, model)
# Above reduction in model results in change of adjusted R-squared from 0.2644 to 0.2535 We get a very small p-value, indicating we fail to reject the null.

# The null condition in this test is that the coefficients of the associated removed predictors when going from model to model2 are all 0. Thus, from the partial f-test, we conclude that all the coefficients from the removed predictors are not significantly linearly related to the response, and thus are removed from the model going forward.

# Smaller model without WOMENONLY. Using a t-test, we see that the p-value of the parameter associated with this coefficient is 0.2533. This is greater than our p-value standard of 0.05. The null is that the parameter is 0. Because the p-value > 0.05, we fail to reject the null and conclude that this parameter is not significantly linearly related to the response, and is thus removed from the model

# Despite this lowering the r^2 of the coefficient, WOMENONLY as a category is a weak predictor as it is highly skewed and categorical.
model3 <- lm(ADM_RATE ~ NUMBRANCH + as.factor(CONTROL) + as.factor(REGION) + TRIBAL + HSI + COSTT4_A + AVGFACSAL + PFTFAC + 
               PAR_ED_PCT_1STGEN + FEMALE + MD_FAMINC + PCT_WHITE + PCT_HISPANIC + PCT_BA + PCT_GRAD_PROF, data=data2)
summary(model3)

# No longer removing PARENTS_EDUCATIONS_PCT_1ST_GEN after data transformations. After correction it is mostly random skew with adm_rate.

# Smaller model without TRIBAL. Once again, performed t-test to justify removal from model4
model5 <- lm(ADM_RATE ~ NUMBRANCH + as.factor(CONTROL) + as.factor(REGION) + HSI + COSTT4_A + AVGFACSAL + PFTFAC + PAR_ED_PCT_1STGEN
             + FEMALE + MD_FAMINC + PCT_WHITE + PCT_HISPANIC + PCT_BA + PCT_GRAD_PROF, data=data2)
summary(model5)
anova(model5, model3)
# No change in r^2 (still 0.2533)

# Smaller model without COSTT4_A. Once again, performed t-test to justify removal from model5
model6 <- lm(ADM_RATE ~ NUMBRANCH + as.factor(CONTROL) + as.factor(REGION) + HSI + AVGFACSAL + PFTFAC + PAR_ED_PCT_1STGEN
             + FEMALE + MD_FAMINC + PCT_WHITE + PCT_HISPANIC + PCT_BA + PCT_GRAD_PROF, data=data2)
summary(model6)
# Above reduction in model results in change of adjusted R-squared from 0.2533 to 0.2524

# Smaller model without MD_FAMINC. Once again, performed t-test to justify removal from model6
model7 <- lm(ADM_RATE ~ as.factor(NUMBRANCH) + as.factor(CONTROL) + as.factor(REGION) + HSI + AVGFACSAL + PFTFAC + PAR_ED_PCT_1STGEN
             + FEMALE + PCT_WHITE + PCT_HISPANIC + PCT_BA + PCT_GRAD_PROF, data=data2)
summary(model7) #r^2 .2651

# removing MD_FAMINC unclear. Scatter is random
```

Limitations

if there's no constant vairance, can't do anything because we haven't learned weighted least squares
every increase in 1 % of female you female, increase or decrease
can;t control other factors that affect the model - environment. 

The chunk below is used to render plots for the slideshow.

```{r}

# final model
model7 <- lm(ADM_RATE ~ as.factor(NUMBRANCH) + as.factor(CONTROL) + as.factor(REGION) + as.factor(HSI) + AVGFACSAL + PFTFAC + PAR_ED_PCT_1STGEN
             + FEMALE + PCT_WHITE + PCT_HISPANIC + PCT_BA + PCT_GRAD_PROF, data=data2)
summary(model7)

# numerical vars
plot(data2$ADM_RATE ~ data2$AVGFACSAL, main="Admission Rates vs. Average Faculty Salary", ylab="Admission Rates", xlab="Average Faculty Salary")
plot(data2$ADM_RATE ~ data2$PFTFAC, main="Admission Rates vs. Proportion of Full Time Faculty", ylab="Admission Rates", xlab="Proportion of Full Time Faculty")
plot(data2$ADM_RATE ~ data2$PAR_ED_PCT_1STGEN, main="Admission Rates vs. Percentage of First Gen. Students", ylab="Admission Rates", xlab="% of First Gen. Students")
plot(data2$ADM_RATE ~ data2$FEMALE, main="Admission Rates vs. Percentage of Female Population", ylab="Admission Rates", xlab="Percentage of Female Population")
plot(data2$ADM_RATE ~ data2$PCT_WHITE, main="Admission Rates vs. Percentage of White Students", ylab="Admission Rates", xlab="Percentage of White Students")
plot(data2$ADM_RATE ~ data2$PCT_HISPANIC, main="Admission Rates vs. Percentage of Hispanic Students", ylab="Admission Rates", xlab="Percentage of Hispanic Students")
plot(data2$ADM_RATE ~ data2$PCT_BA, main="Admission Rates vs. % of popn from std zip code with a Bachelor's degree", ylab="Admission Rates", xlab="% of popn from std zip code with a Bachelor's degree")
plot(data2$ADM_RATE ~ data2$PCT_GRAD_PROF, main="Admission Rates vs. % of popn from std zip code with a Professional degree", ylab="Admission Rates", xlab="% of popn from std zip code with a Professional degree")

# categorical vars
plot(data2$ADM_RATE ~ as.factor(data2$NUMBRANCH), main="Admission Rates vs. Number of Campuses", ylab="Admission Rates", xlab="Number of Campuses")
plot(data2$ADM_RATE ~ as.factor(data2$CONTROL), main="Admission Rates vs. Financial Control of University", ylab="Admission Rates", xlab="Type (1=Public, 2= Private not-for-profit, 3=Private for-profit)")
plot(data2$ADM_RATE ~ as.factor(data2$REGION), main="Admission Rates vs. Region of University", ylab="Admission Rates", xlab="Region Code")
plot(data2$ADM_RATE ~ as.factor(data2$HSI), main="Admission Rates vs. Historically Hispanic Serving Institution", ylab="Admission Rates", xlab="1=yes, 0=no")

pairs(data2[, c(12, 14, 15, 19, 20, 22, 25, 26, 27)])
```
```{r}
plot(data2$ADM_RATE ~ fitted(model7), main="Response versus Fitted Model Values", ylab="Response", xlab="Fitted Values") # Points seem to be scattered evenly around the 45 degrees line for lower values of of the fitted values but the spread increases for higher values of the fitted values.
abline(lm(data2$ADM_RATE ~ fitted(model2)), col = "red")
```
```{r}
plot(residuals(model7) ~ fitted(model7), main="Residuals of Model Versus Fitted Values", xlab="Fitted Values", ylab="Residuals")

aa <- c(12, 14, 15, 19, 20, 22, 25, 26, 27)

for(i in aa)
  plot(residuals(model7) ~ data2[,i], main=substitute(paste('Residuals of Model vs. ', a), list(a=hist_names[i])), xlab=" ", ylab="residuals", cex.main=0.75)
  abline(lm(residuals(model7) ~ data2[,i]), col = "red")
```

```{r}
qqnorm(residuals(model7))
qqline(residuals(model7))
```
```{r}
r <- resid(model7)
hist(r, main="Frequencies of Model Residuals", xlab="Frequency", ylab="Residual Value")
```
```{r}
plot(data2$ADM_RATE ~ fitted(model7), main="Admissions Rate vs. ", xlab="Fitted Values", ylab="Residuals")
```


-->
